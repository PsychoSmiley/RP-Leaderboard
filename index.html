<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>R/RP Leaderboard - LLM Roleplay Benchmark</title>
<meta name="description" content="LLM Roleplay Performance Benchmark">
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{--bg-primary:#000;--bg-secondary:#1c1c1e;--bg-tertiary:#2c2c2e;--bg-hover:#3a3a3c;--text-primary:#fff;--text-secondary:#98989d;--text-tertiary:#666;--accent:#0a84ff;--accent-hover:#409cff;--border:#38383a;--gold:#ffd700;--silver:#c0c0c0;--bronze:#cd7f32}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:var(--bg-primary);color:var(--text-primary);line-height:1.6;min-height:100vh}
.container{max-width:1200px;margin:0 auto;padding:2rem}
header{text-align:center;padding:3rem 0 2rem}
h1{font-size:3rem;font-weight:700;margin-bottom:.5rem;letter-spacing:-.02em}
header p{color:var(--text-secondary);font-size:1.1rem}
.stats{display:flex;gap:3rem;justify-content:center;align-items:center;padding:1.5rem;background:var(--bg-secondary);border-radius:12px;margin-bottom:2rem;border:1px solid var(--border)}
.stats span{color:var(--text-secondary)}
.stats strong{color:var(--text-primary);font-weight:600}
.stats a{color:var(--accent);text-decoration:none;font-weight:500;transition:color .2s}
.stats a:hover{color:var(--accent-hover)}
.table-container{overflow-x:auto;border-radius:12px;background:var(--bg-secondary);border:1px solid var(--border)}
table{width:100%;border-collapse:collapse}
thead{background:var(--bg-tertiary);position:sticky;top:0;z-index:10}
th,td{padding:1rem;border-top:1px solid var(--border)}
th{text-align:left;font-weight:600;color:var(--text-secondary);font-size:.85rem;text-transform:uppercase;letter-spacing:.05em;cursor:pointer;user-select:none;transition:background .2s;border-bottom:1px solid var(--border)}
th:hover{background:var(--bg-hover)}
th:first-child,td:first-child{text-align:center}
th:first-child{width:60px}
th:nth-child(2){min-width:200px}
td{color:var(--text-primary)}
td:first-child{font-weight:600}
td:nth-child(2){font-weight:500}
td:nth-child(5) strong{color:var(--accent);font-size:1.05em}
tbody tr{transition:background .2s}
tbody tr:hover{background:var(--bg-tertiary)}
.rank-1 td:first-child{color:var(--gold);font-size:1.1em}
.rank-2 td:first-child{color:var(--silver);font-size:1.05em}
.rank-3 td:first-child{color:var(--bronze);font-size:1.05em}
.loading{text-align:center!important;color:var(--text-secondary);font-style:italic;padding:2rem!important}
footer{text-align:center;padding:3rem 0 2rem;color:var(--text-tertiary);font-size:.9rem}
footer .small{font-size:.8rem;color:var(--text-secondary)}
footer a{color:var(--accent);text-decoration:none;transition:color .2s}
footer a:hover{color:var(--accent-hover)}
@media (max-width:768px){
h1{font-size:2rem}
.container{padding:1rem}
.stats{flex-direction:column;gap:1rem;text-align:center}
table{font-size:.85rem}
th,td{padding:.75rem .5rem}
th:nth-child(2),td:nth-child(2){min-width:150px}
}
@media (max-width:480px){
h1{font-size:1.75rem}
table{font-size:.75rem}
th,td{padding:.6rem .4rem}
th:nth-child(7),td:nth-child(7){display:none}
}
html{scroll-behavior:smooth}
::selection{background:var(--accent);color:var(--bg-primary)}
</style>
</head>
<body>
<div class="container">
<header>
  <h1>ðŸŽ­ R/RP Leaderboard</h1>
  <p>LLM Roleplay Performance Benchmark</p>
</header>

<div class="stats">
  <span>Models Tested: <strong id="count">0</strong></span>
  <span>Last Updated: <strong id="updated">-</strong></span>
  <a href="#" id="github-link" target="_blank" rel="noopener">GitHub â†—</a>
</div>

<div class="table-container">
  <table id="leaderboard">
    <thead>
      <tr>
        <th onclick="sort(0)" title="Click to sort">#</th>
        <th onclick="sort(1)" title="Click to sort">Model</th>
        <th onclick="sort(2)" title="Click to sort">Yes/No</th>
        <th onclick="sort(3)" title="Click to sort">Open-Ended</th>
        <th onclick="sort(4)" title="Click to sort">Total</th>
        <th onclick="sort(5)" title="Click to sort">%</th>
        <th onclick="sort(6)" title="Click to sort">Date</th>
      </tr>
    </thead>
    <tbody id="tbody">
      <tr><td colspan="7" class="loading">Loading leaderboard data...</td></tr>
    </tbody>
  </table>
</div>

<!-- Raw log view -->
<div id="raw-log-container" style="display:none;margin-top:1.5rem;">
  <h2 style="margin-bottom:1rem;font-size:1.25rem;">Raw Benchmark Log</h2>
  <pre id="raw-log" style="white-space:pre-wrap;background:#111;padding:1rem;border-radius:8px;border:1px solid #38383a;max-height:70vh;overflow:auto;"></pre>
</div>

<footer>
  <p class="small">Scores represent AI judge's evaluation, not universal truth. Higher scores = better odds of finding a model you like, not perfection.</p>
</footer>
</div>

<script>
let data = [], sortCol = 0, sortAsc = !1;

function slugify(name){
  if (!name) return "";
  let s = name.replace(/\//g, "-");
  s = s.replace(/[^a-zA-Z0-9_-]/g, "");
  return s.toLowerCase();
}

async function loadLeaderboard(){
  try{
    const res = await fetch("results.json");
    if(!res.ok) throw new Error(`HTTP ${res.status}`);
    const json = await res.json();

    data = json.leaderboard || [];
    document.getElementById("count").textContent = json.metadata?.total_models || data.length;

    const last = json.metadata?.last_updated;
    document.getElementById("updated").textContent = last ? new Date(last).toLocaleDateString() : "Unknown";

    const params = new URLSearchParams(window.location.search);
    const rawParam = params.get("raw");

    if (rawParam){
      renderRaw(rawParam);
    } else {
      renderTable();
    }
  }catch(err){
    console.error("Failed to load leaderboard:", err);
    showError("Failed to load leaderboard data. Please try again later.");
  }
}

function renderTable(){
  const tbody = document.getElementById("tbody");
  const tableContainer = document.querySelector(".table-container");
  const rawContainer = document.getElementById("raw-log-container");

  tableContainer.style.display = "";
  if (rawContainer) rawContainer.style.display = "none";

  if (data.length === 0){
    tbody.innerHTML = '<tr><td colspan="7" class="loading">No models tested yet.</td></tr>';
    return;
  }

  tbody.innerHTML = data.map((e, i) => {
    const perc = (e.percentage || e.total_score / e.max_score * 100).toFixed(1);
    const date = e.timestamp ? new Date(e.timestamp).toLocaleDateString() : "-";
    const display = e.display_name || e.model_name;
    const slug = slugify(display);

    // "View log" link under model name
    const modelCell = `${escapeHtml(display)}<br><a href="?raw=${slug}" style="font-size:0.8em;color:var(--accent);text-decoration:none;">view log</a>`;

    return `<tr class="rank-${i+1}">
      <td><strong>${e.rank || i+1}</strong></td>
      <td>${modelCell}</td>
      <td>${e.yes_no_score}/${e.yes_no_max || 25}</td>
      <td>${e.open_ended_score}/${e.open_ended_max || 300}</td>
      <td><strong>${e.total_score}/${e.max_score || 325}</strong></td>
      <td>${perc}%</td>
      <td>${date}</td>
    </tr>`;
  }).join("");
}

// Raw log render when ?raw=... is present
function renderRaw(rawParam){
  const tableContainer = document.querySelector(".table-container");
  const rawContainer = document.getElementById("raw-log-container");
  const rawPre = document.getElementById("raw-log");

  tableContainer.style.display = "none";
  rawContainer.style.display = "";

  const headerP = document.querySelector("header p");
  if (headerP) headerP.textContent = "Raw benchmark log";

  if (!data.length){
    rawPre.textContent = "No models found.";
    return;
  }

  // rawParam may be "slug" or "slug_timestamp"
  const baseSlug = rawParam.split("_")[0].toLowerCase();

  let entry = data.find(e => slugify(e.display_name || e.model_name) === baseSlug);

  // fallback: latest entry if exact slug not found
  if (!entry){
    entry = data.slice().sort((a,b) => new Date(b.timestamp || 0) - new Date(a.timestamp || 0))[0];
  }

  if (!entry || !entry.raw_log){
    rawPre.textContent = "No raw log available for this entry.";
  } else {
    rawPre.textContent = entry.raw_log;
  }
}

function sort(col){
  const keys = ["rank","display_name","yes_no_score","open_ended_score","total_score","percentage","timestamp"];
  sortCol === col ? sortAsc = !sortAsc : (sortCol = col, sortAsc = !1);
  const key = keys[col];

  data.sort((a,b)=>{
    let x = a[key] ?? "", y = b[key] ?? "";
    if (key === "timestamp"){
      x = new Date(x).getTime() || 0;
      y = new Date(y).getTime() || 0;
    }
    if (key === "percentage" && !x && a.total_score && a.max_score){
      x = a.total_score / a.max_score * 100;
      y = b.total_score / b.max_score * 100;
    }
    if (typeof x === "string" && typeof y === "string"){
      return sortAsc ? x.localeCompare(y, undefined, {sensitivity:"base"}) : y.localeCompare(x, undefined, {sensitivity:"base"});
    }
    return sortAsc ? x - y : y - x;
  });

  renderTable();
}

function showError(msg){
  document.getElementById("tbody").innerHTML =
    `<tr><td colspan="7" class="loading" style="color:#ff453a;">${escapeHtml(msg)}</td></tr>`;
}

function escapeHtml(s){
  if (typeof s !== "string") return s;
  const div = document.createElement("div");
  div.textContent = s;
  return div.innerHTML;
}

function setGitHubLinks(){
  const host = window.location.hostname;
  if (!host.endsWith(".github.io")){
    document.getElementById("github-link").style.display = "none";
    return;
  }
  const user = host.replace(".github.io","");
  const repo = (window.location.pathname.match(/^\/([^\/]+)/) || [])[1] || "RP-Leaderboard";
  const href = `https://github.com/${user}/${repo}`;
  document.getElementById("github-link").href = href;
}

document.addEventListener("DOMContentLoaded", () => {
  setGitHubLinks();
  loadLeaderboard();
});
</script>
</body>
</html>
